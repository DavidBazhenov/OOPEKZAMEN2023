## С++. Конструкторы и деструкторы. Конструкторы копирования.
### &nbsp;&nbsp;&nbsp;&nbsp;Конструктор и деструктор
>&nbsp;&nbsp;&nbsp;&nbsp;<font color="yellow"> – это специальный метод (функция) класса. Конструктор вызывается при создании объекта класса. </font>

&nbsp;&nbsp;&nbsp;&nbsp;Конструктор класса X, создаваемого пользователем, может иметь параметры любого типа, кроме X; допускается параметр типа const X& (константная ссылка на существующий объект типа X). Конструкторы и деструктор называются специальными методами.

&nbsp;&nbsp;&nbsp;&nbsp;Если пользователь не определяет в классе X ни одного из специальных методов, то компилятор автоматически создает: 
>- конструктор с пустым телом и пустым списком параметров (конструктор по умолчанию); 
>- деструктор с пустым телом
>- конструктор копирования.  

&nbsp;&nbsp;&nbsp;&nbsp;Кроме этого, компилятор автоматически предоставляет пользователю оператор присваивания.  

&nbsp;&nbsp;&nbsp;&nbsp;Явное определение пользователем в классе конструктора с параметрами отменяет автоматическое создание конструктора по умолчанию, определение конструктора копирования отменяет 3, определение деструктора отменяет 2.  

&nbsp;&nbsp;&nbsp;&nbsp;Объявление объекта класса должно соответствовать имеющемуся конструктору. Способы создания объектов те же, что и в языке C: объект может объявляться как простая переменная, массив, указатель. Для создания массива объектов следует иметь в классе конструктор без параметров или конструктор, у которого все параметры заданы по умолчанию.
```
class date
{
  int day, year;
  char *month;
public:
  date(int d, char* m, int y)
  {
    day = d;
    month = new char[strlen(m)+1];
    strcpy_s(month, strlen(m)+1,m);
    year = y;
  }
  ~date() { delete[] month; } // деструктор
};
```
---

### Конструктор копирования  

>&nbsp;&nbsp;&nbsp;&nbsp;<font color="yellow">– это специальный конструктор, который позволяет получить идентичный к заданному объект. То есть, с помощью конструктора копирования можно получить копию уже существующего объекта. Конструктор копирования еще называется инициализатором копии (copy initializer). Конструктор копирования должен получать входным параметром константную ссылку (&) на объект такого же класса.</font>  

&nbsp;&nbsp;&nbsp;&nbsp;Конструктор копирования вызывается в случаях, когда нужно получить полную копию объекта. В C++ полная копия объекта нужна в трех случаях.

+ &nbsp;&nbsp;&nbsp;&nbsp; Случай 1. В момент объявления нового объекта и его инициализации данными другого объекта с помощью оператора =. Следующий фрагмент кода демонстрирует данную ситуацию для некоторого класса ClassName
    ```
    // объявление экземпляра (объекта) класса ClassName
    ClassName obj1;
    
    // объявление объекта obj2 с одновременной инициализацией данными объекта obj2
    ClassName obj2 = obj1;  
    // вызывается конструктор копирования
    ```
    &nbsp;&nbsp;&nbsp;&nbsp;В этом случае нужно скопировать данные из объекта obj1 в объект obj2. То есть, нужно создать копию объекта obj1 так, чтобы этот объект мог в дальнейшем корректно использоваться в программе. Поэтому нужна копия. Этим занимается конструктор копирования.

+ &nbsp;&nbsp;&nbsp;&nbsp; Случай 2. Когда нужно передать объект в функцию как параметр-значение. В этом случае создается полная копия объекта.

+ &nbsp;&nbsp;&nbsp;&nbsp; Случай 3. Когда нужно вернуть объект из функции по значению. В этом случае также создается полная копия объекта. 

#### Пример объявления конструктора копирования в классе, где нет динамического выделения памяти  
&nbsp;&nbsp;&nbsp;&nbsp; Данный пример носит демонстрационный характер. Для класса, где нет динамического выделения памяти использовать конструктор копирования необязательно.

&nbsp;&nbsp;&nbsp;&nbsp; Пример. Пусть задан класс CMyPoint, описывающий точку на координатной плоскости. В классе объявляется несколько конструкторов, в том числе и конструктор копирования.
```
// класс CMyPoint
class CMyPoint
{
    int x, y;

    public:
    CMyPoint(void); // конструктор класса по умолчанию
    CMyPoint(int nx, int ny); // конструктор класса с двумя параметрами
    CMyPoint(const CMyPoint & ref_Point); // конструктор копирования

    // методы доступа - реализованы в классе
    int GetX(void) { return x; }
    int GetY(void) { return y; }
};

// реализация конструкторов (методов) класса
// конструктор класса CMyPoint
CMyPoint::CMyPoint(void)
{
    x = y = 0;
}

// конструктор класса CMyPoint с двумя параметрами
CMyPoint::CMyPoint(int nx, int ny)
{
    x = nx;
    y = ny;
}

// конструктор копирования класса CMyPoint
// передается ссылка на CMyPoint
CMyPoint::CMyPoint(const CMyPoint & ref_Point)
{
    // копирование данных из одного объекта в другой
    x = ref_Point.x;
    y = ref_Point.y;
}
```
&nbsp;&nbsp;&nbsp;&nbsp; Демонстрация использования конструктора копирования в некотором программном коде (методе)
```
// демонстрация использования конструктора копирования
CMyPoint p1(5, 8); // создание объекта p1
CMyPoint p2; // создание объекта p2 - вызывается конструктор по умолчанию

// проверка
int d;
d = p1.GetX(); // d = 5
d = p2.GetX(); // d = 0

p2 = p1; // побитовое копирование, конструктор копирования не вызывается
d = p2.GetX(); // d = 5 - данные были скопированы, но без использования конструктора копирования

// код, который вызывает конструктор копирования
CMyPoint p3 = p1; // инициализация объекта => вызывается конструктор копирования
d = p3.GetX(); // d = 5
```
